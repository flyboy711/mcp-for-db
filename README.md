# MCP-For-DB
## 1. ç®€ä»‹
å®˜æ–¹ä»“åº“åœ°å€ï¼šhttps://github.com/wenb1n-dev/mysql_mcp_server_pro.

æœ¬é¡¹ç›®å€Ÿé‰´å®˜æ–¹ä»“åº“åŸºäºŽ Low-Level æŽ¥å£è®¾è®¡å·¥å…·ã€æç¤ºè¯è‡ªåŠ¨æ³¨å†Œä¸Žå‘çŽ°çš„æž¶æž„è®¾è®¡æ€è·¯ï¼Œåœ¨å…¶åŸºç¡€ä¸Šåšè¿›ä¸€æ­¥å¼€å‘ï¼Œè¿›ä¸€æ­¥å¢žå¼º MCP for DB çš„åŠŸèƒ½ã€‚

å®˜æ–¹ä»“åº“ä¸­åŸºäºŽ Low-Level æŽ¥å£è®¾è®¡å·¥å…·ã€æç¤ºè¯è‡ªåŠ¨æ³¨å†Œä¸Žå‘çŽ°è®¾è®¡æ€è·¯å¦‚ä¸‹ï¼š

![](assets/ed78e452.png)

åŸºäºŽå…±æ€§çš„è®¾è®¡ç†å¿µï¼Œæ‰©å……äº†èµ„æºçš„è‡ªåŠ¨æ³¨å†Œå’Œå‘çŽ°ï¼Œä»¥åŠåœ¨å·¥å…·ä¸­è¡¥å……äº†å·¥å…·ç¼–æŽ’å’Œå·¥å…·æè¿°å¢žå¼ºåŠŸèƒ½ï¼š

![](assets/931a1017.png)

åŒæ—¶ï¼Œæˆ‘ä»¬å°†å•ä½“æœåŠ¡æ”¹æˆäº†å¾®æœåŠ¡å¼æž¶æž„ï¼Œæ”¯æŒæ˜“æ‰©å±•å¼æ–°å¢žæ–° MCP Serverï¼Œç±»å›¾å¦‚ä¸‹ï¼š

![](assets/974a18e6.png)

åŸºäºŽ Pythonï¼Œæˆ‘ä»¬é‡‡ç”¨å·¥åŽ‚æ¨¡å¼å’Œå•ä¾‹æ¨¡å¼è®¾è®¡äº†å¾®æœåŠ¡æœåŠ¡å¯åŠ¨ã€æœåŠ¡æ³¨å†Œçš„ç®¡ç†ç±»ï¼Œå•ä½“æœåŠ¡å¯åŠ¨å…³ç³»å¦‚å›¾ï¼š

![](assets/56ff7ca6.png)

è€Œä¸”ï¼Œæˆ‘ä»¬è¿˜å¼€å‘äº†ç›¸åº”çš„å®¢æˆ·ç«¯ï¼Œæ”¯æŒå¤„ç†å¤šä¸ª MCP Serverï¼š

![](assets/1a83acf4.png)

æœ€åŽï¼Œæˆ‘ä»¬è¿˜å®žçŽ°äº† FastAPI æŽ¥å£ï¼Œè¯¥æŽ¥å£æŽ¥æ”¶ç”¨æˆ·çš„æé—®ï¼Œç„¶åŽç»è¿‡å®¢æˆ·ç«¯+æœåŠ¡ç«¯çš„é»‘ç›’åŒ–å¤„ç†ï¼ŒæŽ¥å£æœ€ç»ˆè¿”å›žç»å¤§æ¨¡åž‹å¤„ç†åŽçš„ç”¨æˆ·çš„é—®é¢˜çš„ç­”æ¡ˆã€‚

## 2. åŠŸèƒ½ä»‹ç»
æœ¬æœåŠ¡æä¾›è‡ªç„¶è¯­è¨€æ“ä½œæ•°æ®åº“çš„åŠŸèƒ½ï¼Œè®©æ‚¨ç›´æŽ¥ä½¿ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢æ•°æ®åº“ï¼Œæ¯”å¦‚æè¿°æŸ¥è¯¢éœ€æ±‚ï¼Œåˆ†æžæ•°æ®åº“å¥åº·çŠ¶æ€ï¼Œåˆ†æžå¤æ‚ SQL è¯­å¥ï¼Œæ…¢æŸ¥è¯¢ç­‰ï¼Œä½†åšäº† SQL é‰´æƒå“¦ã€‚
åŒæ—¶ï¼Œæœ¬æœåŠ¡åŸºäºŽå¾®æœåŠ¡è®¾è®¡æ€æƒ³ä¹Ÿæ·»åŠ äº†è®¿é—® Dify çŸ¥è¯†åº“çš„åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥é…ç½®å¥½ç›¸å…³ä¿¡æ¯è®¿é—® Dify ä¸­æ­å»ºçš„çŸ¥è¯†åº“ã€‚

æœ¬é¡¹ç›®ä¸Žå‚è€ƒçš„å¼€æºé¡¹ç›®çš„å…±æ€§å’ŒåŒºåˆ«å¦‚ä¸‹ï¼š

å…±æ€§ï¼š
- æ”¯æŒæ‰€æœ‰æ¨¡åž‹ä¸Šä¸‹æ–‡åè®® (MCP) ä¼ è¾“æ¨¡å¼ (STDIOã€SSEã€Streamable Http)
- æ”¯æŒ OAuth2.0ï¼›æ”¯æŒä¸­æ–‡å­—æ®µè½¬æ‹¼éŸ³
- æ”¯æŒæ ¹æ®è¡¨æ³¨é‡ŠæŸ¥è¯¢æ•°æ®åº“è¡¨åå’Œå­—æ®µï¼›æ”¯æŒ SQL æ‰§è¡Œè®¡åˆ’åˆ†æžï¼›æ”¯æŒè¡¨é”åˆ†æžï¼›æ”¯æŒæ•°æ®åº“å¥åº·çŠ¶æ€åˆ†æž

åŒºåˆ«ï¼šæ–°å¢žéƒ¨åˆ†æ•°æ®åº“å·¥å…·ï¼Œèµ„æºåŠ è½½åŠŸèƒ½ï¼Œæ•°æ®åº“ä¾§çš„è¿žæŽ¥æ± ä¼˜åŒ–ï¼ŒSQLé‰´æƒï¼ŒDiFyçŸ¥è¯†åº“è®¿é—®å·¥å…·ä»¥åŠå®¢æˆ·ç«¯ã€‚
- æ•°æ®åº“ä¾§çš„è¿žæŽ¥æ± ä¼˜åŒ–ï¼›çŽ¯å¢ƒå˜é‡çš„å¤šæœåŠ¡è‡ªé€‚åº”åŠ è½½ï¼›ä¼šè¯çº§åˆ«çš„çŽ¯å¢ƒé…ç½®ç®¡ç†å™¨
- æ”¯æŒ å¤šç”¨æˆ·éš”ç¦»è®¿é—®æ•°æ®åº“ï¼ŒæŸç”¨æˆ·ä¿®æ”¹é…ç½®ï¼Œå…¶ä»–ç”¨æˆ·æ— æ„Ÿï¼Œäº’ä¸å¹²æ‰°
- æ”¯æŒ å¸¦ SQL æ‹¦æˆªè§£æžæƒé™è®¤è¯çš„ SQL æ‰§è¡Œ&æ‰§è¡Œè®¡åˆ’åˆ†æž
- æ”¯æŒ èµ„æºæš´éœ²æŽ¥å£çš„å¯æ‰©å±•å®šåˆ¶ï¼šæ•°æ®åº“ä¸­è¡¨èµ„æºã€SQLæ‰§è¡ŒåŽ†å²æ—¥å¿—èµ„æºç­‰
- æ”¯æŒ èŽ·å–æ•°æ®åº“åŸºæœ¬ä¿¡æ¯ï¼›èŽ·å–æ•°æ®åº“æ‰€æœ‰è¡¨å’Œå¯¹åº”çš„è¡¨æ³¨é‡Šï¼›èŽ·å–è¡¨ç»Ÿè®¡ä¿¡æ¯å’Œåˆ—ç»Ÿè®¡ä¿¡æ¯ï¼›æ£€æŸ¥è¡¨çº¦æŸä¿¡æ¯
- æ”¯æŒ èŽ·å–å½“å‰è¿›ç¨‹åˆ—è¡¨ï¼›åŠ¨æ€åˆ‡æ¢æ•°æ®åº“è¿žæŽ¥é…ç½®ï¼›Smart ç¼–æŽ’å·¥å…·
- æ”¯æŒ åˆ†æž SQL æŸ¥è¯¢æ€§èƒ½ï¼›åˆ†æž SQL æŸ¥è¯¢è¯­å¥ï¼ŒåŸºäºŽæ•°æ®åº“å…ƒæ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯æŽ¨èç´¢å¼•æ–¹æ¡ˆï¼› æ…¢æŸ¥è¯¢åˆ†æž
- æ”¯æŒ è®¿é—®æ£€ç´¢ DiFy çŸ¥è¯†åº“ï¼ŒçŸ¥è¯†åº“çŠ¶æ€è¯Šæ–­å·¥å…·ã€‚
- å¢žåŠ æ‰§è¡Œæ—¥å¿—è®°å½•ï¼›åŽ†å² SQL æŸ¥è¯¢è®°å½•ï¼›APIè¯·æ±‚å±‚æ‹¦æˆªè®°å½•ç™»é™†äººæ—¥å¿—ã€‚

## 3. å·¥å…·åˆ—è¡¨

| å·¥å…·                        | åŠŸèƒ½è¯´æ˜Ž                                                    |
|---------------------------|---------------------------------------------------------|
| sql_executor              | æ‰§è¡Œå•æ¡SQLè¯­å¥ï¼Œä½†åšäº†SQLå®‰å…¨åˆ†æžã€èŒƒå›´æ£€æŸ¥å’Œæƒé™æŽ§åˆ¶ï¼Œä¸”åªå…è®¸ä½¿ç”¨å®‰å…¨çš„å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥æ”»å‡»ã€‚ |
| get_table_name            | æ ¹æ®è¡¨ä¸­æ–‡åæˆ–è¡¨æè¿°æœç´¢æ•°æ®åº“ä¸­å¯¹åº”çš„è¡¨å                                   |
| get_table_desc            | æ ¹æ®è¡¨åæœç´¢æ•°æ®åº“ä¸­å¯¹åº”çš„è¡¨å­—æ®µåŠæ³¨é‡Š                                     |
| get_table_index           | æ ¹æ®è¡¨åæœç´¢æ•°æ®åº“ä¸­å¯¹åº”çš„è¡¨ç´¢å¼•                                        |
| get_table_lock            | èŽ·å–å½“å‰ MySQL æœåŠ¡å™¨è¡Œçº§é”ã€è¡¨çº§é”æƒ…å†µ                                 |
| get_database_info         | èŽ·å–æ•°æ®åº“åŸºæœ¬ä¿¡æ¯                                               |
| get_database_tables       | èŽ·å–æ•°æ®åº“æ‰€æœ‰è¡¨å’Œå¯¹åº”çš„è¡¨æ³¨é‡Š                                         |
| get_table_stats           | èŽ·å–è¡¨ç»Ÿè®¡ä¿¡æ¯å’Œåˆ—ç»Ÿè®¡ä¿¡æ¯                                           |
| check_table_constraints   | æ£€æŸ¥è¡¨çº¦æŸä¿¡æ¯                                                 |
| get_process_list          | èŽ·å–å½“å‰è¿›ç¨‹åˆ—è¡¨                                                |
| get_db_health_running     | èŽ·å–å½“å‰ MySQL çš„å¥åº·çŠ¶æ€                                        |
| get_db_health_index_usage | èŽ·å–å½“å‰è¿žæŽ¥çš„MySQLåº“çš„ç´¢å¼•ä½¿ç”¨æƒ…å†µ,åŒ…å«å†—ä½™ç´¢å¼•æƒ…å†µã€æ€§èƒ½è¾ƒå·®çš„ç´¢å¼•æƒ…å†µ                 |
| switch_database           | åŠ¨æ€åˆ‡æ¢æ•°æ®åº“è¿žæŽ¥é…ç½®                                             |
| analyze_query_performance | åˆ†æžSQLæŸ¥è¯¢çš„æ€§èƒ½ç‰¹å¾ï¼ŒåŒ…æ‹¬æ‰§è¡Œæ—¶é—´ã€èµ„æºä½¿ç”¨ç­‰                               |
| collect_table_stats       | æ”¶é›†æŒ‡å®šè¡¨çš„å…ƒæ•°æ®ã€ç»Ÿè®¡ä¿¡æ¯å’Œæ•°æ®åˆ†å¸ƒæƒ…å†µï¼ˆå¦‚NDVç­‰ï¼‰                            |                            
| smart_tool                | åŠ¨æ€ç¼–æŽ’å·²æœ‰å·¥å…·ï¼šæé—®æ—¶å¯æŒ‡å®šä½¿ç”¨è¯¥å·¥å…·è¿›è¡Œå›žç­”                                |                           

## 4. ä½¿ç”¨è¯´æ˜Ž
### 4.1 æœ¬åœ°å¼€å‘æµ‹è¯•
é¡¹ç›®æœ€å¥½åˆ›å»ºå•ç‹¬çš„è™šæ‹ŸçŽ¯å¢ƒï¼Œè€Œåœ¨åŒæ­¥è™šæ‹ŸçŽ¯å¢ƒå‰ï¼Œéœ€å…ˆç”Ÿæˆå¯¹åº”çš„ `requirements.txt` ä¾èµ–æ–‡ä»¶ï¼š
```bash
uv pip compile pyproject.toml -o requirements.txt
```
ç„¶åŽåŒæ­¥è™šæ‹ŸçŽ¯å¢ƒï¼ˆä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è‡ªåŠ¨åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒï¼‰ï¼š
```bash
uv sync
```
å®‰è£…ä¾èµ–åŒ…ï¼š
```bash
uv pip install -r requirements.txt
```
é¡¹ç›®æ”¯æŒä¸‰ç§é€šä¿¡æœºåˆ¶ï¼šstdioã€sseã€streamable_httpï¼Œé»˜è®¤ stdioã€‚

æˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­å¯åŠ¨ MCP æœåŠ¡å™¨ï¼š
æ³¨æ„è‹¥é‡‡ç”¨ `stdio` é€šä¿¡æœºåˆ¶ï¼Œéœ€è¦è®¾ç½®çŽ¯å¢ƒå˜é‡ï¼š
```bash
export MYSQL_HOST="localhost"
export MYSQL_PORT="13308"
export MYSQL_USER="videx"
export MYSQL_PASSWORD="password"
export MYSQL_DATABASE="tpch_tiny"
export DIFY_BASE_URL="https://aistudio.dewu-inc.com/v1"
export DIFY_API_KEY="dataset-2v5Y9RVF6YJtHNaog49RlZR7"
export DIFY_DATASET_ID="03918555-2466-4a7d-b7cd-b30d973934eb"
```
```bash
# ç»ˆç«¯å¯åŠ¨æ‰€æœ‰ mcp server
python -m mcp_for_db.server.cli.server --mode stdio --aggregated

# ç»ˆç«¯å•ç‹¬å¯åŠ¨ mysql mcp server
python -m mcp_for_db.server.cli.mysql_cli

# ç»ˆç«¯å•ç‹¬å¯åŠ¨ dify mcp server
python -m mcp_for_db.server.cli.dify_cli

# ç»ˆç«¯æ‰§è¡Œ FastAPI æœåŠ¡
python -m mcp_for_db.client.api

# ç»ˆç«¯å¯åŠ¨äº¤äº’å¼å®¢æˆ·ç«¯
python -m mcp_for_db.client.client 

# å…·ä½“å‘½ä»¤è¡Œå‚æ•°å¼å¯åŠ¨è¯·æŸ¥çœ‹å¯¹åº”æœåŠ¡çš„æºç ï¼Œæ­¤å¤„ä»…ä»¥ mode ä¸ºä¾‹ï¼šå‘½ä»¤è¡Œå‚æ•°åˆ‡æ¢å¯åŠ¨é‡‡ç”¨çš„é€šä¿¡æœºåˆ¶
python -m mcp_for_db.server.cli.mysql_cli --mode sse

# å¯åŠ¨ oauth è®¤è¯
python -m mcp_for_db.server.cli.mysql_cli --oauth true
```

VSCode ä¸­å®‰è£… Cline æ’ä»¶å¹¶é…ç½® JSON æ–‡ä»¶è¿›è¡Œè®¿é—®ï¼š
```bash
# æ³¨æ„å¯åŠ¨å¤šæœåŠ¡çš„è„šæœ¬å‚æ•°æ ¼å¼
python -m mcp_for_db.server.cli.mysql_cli --mode streamable_http 
```
```json
{
  "mcpServers": {
    "mcp_mysql": {
      "timeout": 60,
      "type": "streamableHttp",
      "url": "http://localhost:3000/mcp/"
    }
  }
}
```

ç›¸åº”çš„ï¼Œ`sse` æ¨¡å¼é…ç½®ï¼š
```bash
python -m mcp_for_db.server.cli.mysql_cli --mode sse 
```
å¯¹åº”çš„ Json é…ç½®ï¼š
```json
 "mcp_for_db_sse": {
      "disabled": true,
      "timeout": 60,
      "type": "sse",
      "url": "http://localhost:9000/sse"
    },
```


è‹¥å¯ç”¨è®¤è¯æœåŠ¡,é»˜è®¤ä½¿ç”¨è‡ªå¸¦çš„OAuth 2.0 å¯†ç æ¨¡å¼è®¤è¯ï¼Œå¯ä»¥åœ¨ `envs/common.env` ä¸­ä¿®æ”¹è‡ªå·±çš„è®¤è¯æœåŠ¡åœ°å€ï¼š
```bash
# ç™»å½•é¡µé¢é…ç½®
MCP_LOGIN_URL=http://localhost:3000/login

OAUTH_USER_NAME=admin
OAUTH_USER_PASSWORD=admin
```

å†ä¿®æ”¹ Cline çš„ MCP Json é…ç½®æ–‡ä»¶ï¼š
```json
{
  "mcpServers": {
    "mcp_mysql": {
      "timeout": 60,
      "type": "streamableHttp",
      "description": "",
      "isActive": true,
      "url": "http://localhost:3000/mcp/",
      "headers": {
        "authorization": "bearer TOKENå€¼"
      }
    }
  }
}
```

é‡‡ç”¨ stdio æ–¹å¼å¯åŠ¨ï¼š
```bash
python -m mcp_for_db.server.cli.mysql_cli
```

åœ¨ Cline ä¸­æ·»åŠ å¦‚ä¸‹ Json é…ç½®ï¼š
```json
{
  "mcpServers": {
    "mcp_for_db_stdio": {
      "type": "stdio",
      "command": "uv",
      "args": [
        "--directory",
        "/Users/admin/Downloads/Codes/MCP/mcp_for_db/mcp_for_db",
        "run",
        "-m",
        "server.cli.mysql_entry"
      ],
      "env": {
        "MYSQL_HOST": "localhost",
        "MYSQL_PORT": "13308",
        "MYSQL_USER": "videx",
        "MYSQL_PASSWORD": "password",
        "MYSQL_DATABASE": "tpch_tiny"
      }
    }
  }
}
```

### 4.2 æ‰“åŒ…æž„å»ºä¸Šä¼ â«
```bash
# å…ˆä¸‹è½½æž„å»ºä¾èµ–åŒ…
pip install --upgrade pip build twine

# æž„å»ºé¡¹ç›®
python -m build

# æœ¬åœ°å®‰è£…
pip install .

# æœ¬åœ°å¯åŠ¨ FastAPI æœåŠ¡
mcp_api

# æœ¬åœ°å¯åŠ¨äº¤äº’å¼å®¢æˆ·ç«¯
mcp_client

# æœ¬åœ°å¯åŠ¨æœåŠ¡ç«¯
mcp_for_db

# æœ¬åœ°å•ç‹¬å¯åŠ¨ mysql æœåŠ¡ç«¯
mcp_mysql

# ä¸Šä¼ åˆ°ä»“åº“
twine upload -r dewuPython dist/*
```

## 5. æ•ˆæžœå±•ç¤º

æ³¨æ„ï¼šå¦‚æžœä¸æä¾›æ•°æ®åº“çŽ¯å¢ƒé…ç½®ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ä¼šé»˜è®¤æä¾›ä¸€ä¸ªæµ‹è¯•çŽ¯å¢ƒä¸­çš„æ•°æ®åº“ï¼Œæ•…è€Œç”¨æˆ·ä¸æŒ‡å®šæ—¶ï¼Œé—®ç­”å‰ï¼Œéœ€åˆ‡æ¢æ•°æ®åº“è¿žæŽ¥çš„é…ç½®ä¿¡æ¯ã€‚

åœ¨ Cline ä¸­é…ç½®å¥½é˜¿é‡Œé€šä¹‰åƒé—®å¤§æ¨¡åž‹ API-KEY åŽï¼Œè¿›è¡Œæé—®å³å¯ã€‚
âš ï¸ï¼šé˜¿é‡Œé€šä¹‰åƒé—®å¤§æ¨¡åž‹é…ç½®å¯å‚è€ƒï¼šhttps://help.aliyun.com/zh/model-studio/cline

### 5.1 åˆ‡æ¢æ•°æ®åº“

```
æé—®ï¼šè¯·å…ˆæŸ¥è¯¢å½“å‰æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯,ç„¶åŽåˆ‡æ¢åˆ°å¦‚ä¸‹æ•°æ®åº“:
åˆ‡æ¢æ•°æ®åº“ä¸ºä¸»æœºloacalhost,ç«¯å£13308,ç”¨æˆ·åvidex,å¯†ç password,æ•°æ®åº“ä¸ºtpch_tiny.
åˆ‡æ¢åŽå†æ¬¡æŸ¥è¯¢æ•°æ®åº“åŸºæœ¬ä¿¡æ¯.
```

![](assets/a942bdd8.png)

å±•ç¤ºå®Œï¼Œå¼€å§‹åˆ‡æ¢æ•°æ®åº“ï¼Œæ­¤å¤„éœ€è¦æŽ§åˆ¶æƒé™ï¼Œä¸èƒ½æ˜¯adminï¼Œé»˜è®¤åªè¯»çš„ã€‚

![](assets/4f2212d9.png)

OKï¼Œæ¨¡åž‹ç»™å‡ºäº†æ€»ç»“ä¿¡æ¯å¦‚ä¸‹ï¼Œåˆ‡æ¢æˆåŠŸï¼Œæ³¨æ„ä¸€ä¸ªç”¨æˆ·çš„åˆ‡æ¢ï¼Œä¸å½±å“å…¶ä»–ç”¨æˆ·ä¸Žæ¨¡åž‹çš„äº¤æµå“¦ï¼Œå› ä¸ºæŽ§åˆ¶åœ¨äº†ä¼šè¯å±‚ï¼Œå½¼æ­¤é—´æ— æ„Ÿã€‚

![](assets/2de803e6.png)

### ä»»æ„æŸ¥è¯¢éœ€æ±‚

![](assets/7d2ded0c.png)
![](assets/22311dfc.png)

å‘çŽ°è§£æžé”™äº†ï¼Œå¼€å§‹è‡ªåŠ¨çŸ«æ­£ï¼š

![](assets/078139ad.png)

okï¼ŒçŽ°åœ¨çœ‹èµ·æ¥å°±å¯¹å¤šäº†ï¼Œå¼€å§‹æ‰§è¡ŒðŸ”§è¿è¡ŒæŒ‡ä»¤å¹¶è¿”å›žç»“æžœï¼š

![](assets/0b24bcc2.png)

æœ€ç»ˆæ‰§è¡Œç»“æžœå¦‚ä¸‹ï¼š

![](assets/d2f3a319.png)

### 5.2 èŽ·å–è¡¨åŠè¡¨æ³¨é‡Š

![9c996883](assets/9c996883.png)

### 5.3 æ…¢æŸ¥è¯¢åˆ†æž

![](assets/fcedd026.png)

æ¡ˆä¾‹äºŒï¼šåˆ†æžVidexä¸­çš„è”è¡¨æŸ¥è¯¢ã€‚

```sql
SELECT n_name,
       SUM(l_extendedprice * (1 - l_discount)) AS revenue
FROM customer,
     orders,
     lineitem,
     supplier,
     nation,
     region
WHERE c_custkey = o_custkey
  AND l_orderkey = o_orderkey
  AND l_suppkey = s_suppkey
  AND c_nationkey = s_nationkey
  AND s_nationkey = n_nationkey
  AND n_regionkey = r_regionkey
  AND r_name = 'ASIA'
  AND o_orderdate >= '1994-01-01'
  AND o_orderdate < '1995-01-01'
GROUP BY n_name
ORDER BY revenue DESC;

æ ¹æ®å½“å‰çš„ç´¢å¼•æƒ…å†µï¼ŒæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’æå‡ºä¼˜åŒ–æ„è§ï¼Œä»¥markdownæ ¼å¼è¾“å‡ºï¼Œsqlç›¸å…³çš„è¡¨ç´¢å¼•æƒ…å†µã€æ‰§è¡Œæƒ…å†µï¼Œä¼˜åŒ–æ„è§
```

æ¨¡åž‹æ‰§è¡Œæ•ˆæžœï¼š

![](assets/c13af2ed.png)
![](assets/01bb3934.png)
![](assets/7897fac4.png)

### å¥åº·çŠ¶æ€åˆ†æž

![image.png](assets/49fr45m7m.png)

æé—®æ—¶ï¼Œå¯ä»¥æé—®å¤šä¸ªä»»åŠ¡ï¼Œæ¨¡åž‹è§£æžåŽä¼šé€ä¸ªç¼–æŽ’è°ƒç”¨å·¥å…·æ‰§è¡Œï¼š

![](assets/fedbf007.png)
![](assets/b89707e8.png)

### 5.4 Smart å·¥å…·ç¼–æŽ’

```
è¯·ä½¿ç”¨smartå·¥å…·å®žçŽ°å¦‚ä¸‹éœ€æ±‚ï¼šè¯·å¸®æˆ‘æŸ¥è¯¢å½“å‰æ•°æ®åº“è¡¨t-users ä¸­å¹´é¾„åœ¨25åˆ°27å²ï¼Œå¼ å§“ç”¨æˆ·çš„æ‰€æœ‰æ•°æ®ï¼Œå¹¶æ£€æŸ¥å½“å‰è¡¨çš„ç´¢å¼•æƒ…å†µå’Œå½“å‰è¡¨çš„æ‰€æœ‰å­—æ®µä¿¡æ¯ã€‚
```

![](assets/a67bc789.png)
![](assets/d7811929.png)

### é«˜å±æ“ä½œéªŒè¯

åœ¨æ‰§è¡Œé«˜å± SQL è¯­å¥å‰ï¼Œä¼šæ‹¦æˆªå¹¶ä½œè§£æžï¼Œåˆ¤æ–­æ˜¯å¦ä¸Žé¢„å…ˆå…è®¸çš„æ“ä½œä¸€è‡´ï¼Œä¸ä¸€è‡´åˆ™ä¸æ”¾è¡Œï¼Œæ¨¡åž‹æ— æ³•æ“ä½œæ•°æ®åº“ï¼ŒæŠ¥é”™ç»ˆæ­¢ä»»åŠ¡ã€‚
![](assets/67e89c1f.png)

å½“æƒ³æ›´æ–°è¡¨ä¸­æ•°æ®æ—¶ï¼š

![](assets/897f1470.png)

![](assets/195ed279.png)

æ€»ç»“å°±æ˜¯ï¼šç›®å‰æƒé™é™å®šä¸ºæŸ¥è¯¢æ“ä½œDQLã€‚


### 5.5 è‡ªå»ºå®¢æˆ·ç«¯æé—®
```bash
å½“å‰æ•°æ®åº“åŸºæœ¬ä¿¡æ¯ï¼Œä»¥åŠåŒ…å«å“ªäº›è¡¨åŠè¡¨å­—æ®µã€‚
```
ç»ˆç«¯ç»™å‡ºçš„æ•ˆæžœï¼š
![](assets/db6a36a1.png)